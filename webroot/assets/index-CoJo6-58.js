(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();class E{constructor(t=18,i=18,s=!1){this.width=t,this.height=i,this.wrapping=s}}class p{constructor(t){this.underlying=t}get x(){return(this.underlying&65535)<<16>>16}get y(){return this.underlying>>>16<<16>>16}toString(){return`Point(${this.x}, ${this.y})`}static apply(t,i){const s=t<<16>>16&65535,e=i<<16>>16&65535;return new p(s&65535|e<<16)}}class w{constructor(t,i,s,e){this.char=t,this.x=i,this.y=s,this.vertical=e}}class C{constructor(t,i,s){this.index=t,this.vertical=i,this.word=s}}class y{nextDouble(){return Math.random()}nextInt(t){return Math.floor(Math.random()*t)}}class u{constructor(t,i,s){this.chars=t,this.config=i,this.words=s}static empty(t){return new u(Array(t.width*t.height).fill(" "),t,new Set)}get density(){let t=0;for(const i of this.words)t+=i.length;return t/this.chars.length}toIndex(t,i){return i*this.config.width+(t%this.config.width+this.config.width)%this.config.width}getChar(t,i){return i<0||i>=this.config.height||!this.config.wrapping&&(t<0||t>=this.config.width)?" ":this.chars[this.toIndex(t,i)]}isEmpty(t,i){return this.getChar(t,i)===" "}hasChar(t,i){return this.getChar(t,i)!==" "}copyWithWord(t,i,s,e){const n=this.chars.slice();if(s)for(let o=0;o<e.length;o++)n[this.toIndex(t,i+o)]=e[o];else for(let o=0;o<e.length;o++)n[this.toIndex(t+o,i)]=e[o];const r=new Set(this.words);return r.add(e),new u(n,this.config,r)}fits(t,i,s,e){let n=!1;for(let r=0;r<t.length;r++){const o=i?s:s+r,l=i?e+r:e,h=this.getChar(o,l),c=h===t[r],a=h===" ";if(c&&(n=!0),!((c||a)&&(!a||(i?!this.hasChar(o-1,l)&&!this.hasChar(o+1,l):!this.hasChar(o,l-1)&&!this.hasChar(o,l+1)))))return!1}return n?i?!this.hasChar(s,e-1)&&!this.hasChar(s,e+t.length):!this.hasChar(s-1,e)&&!this.hasChar(s+t.length,e):!1}addWord(t){const i=this.positions,s=new Map;for(let n=0;n<t.length;n++){const r=t[n];s.has(r)||s.set(r,[]),s.get(r).push(n)}const e=[];for(const[n,r]of s.entries()){const o=i.get(n)??[];for(const l of o)for(const h of r){const c=l.vertical?l.x:l.x-h,a=l.vertical?l.y-h:l.y,f=l.vertical?c:c+t.length-1,k=l.vertical?a+t.length-1:a;c>=0&&a>=0&&f<this.config.width&&k<this.config.height&&this.fits(t,l.vertical,c,a)?e.push(this.copyWithWord(c,a,l.vertical,t)):this.config.wrapping&&this.fits(t,l.vertical,c,a)&&e.push(this.copyWithWord(c,a,l.vertical,t))}}return e}get positions(){const t=[];for(let s=0;s<this.chars.length;s++){const e=this.chars[s];if(e!==" "){const n=s%this.config.width,r=Math.floor(s/this.config.width);this.isEmpty(n+1,r)&&this.isEmpty(n-1,r)&&(this.isEmpty(n+1,r+1)&&this.isEmpty(n+1,r-1)&&n<this.config.width-1||this.isEmpty(n-1,r+1)&&this.isEmpty(n-1,r-1)&&n>0)?t.push(new w(e,n,r,!1)):this.isEmpty(n,r+1)&&this.isEmpty(n,r-1)&&(this.isEmpty(n+1,r+1)&&this.isEmpty(n-1,r+1)&&r<this.config.height-1||this.isEmpty(n+1,r-1)&&this.isEmpty(n-1,r-1)&&r>0)&&t.push(new w(e,n,r,!0))}}const i=new Map;for(const s of t)i.has(s.char)||i.set(s.char,[]),i.get(s.char).push(s);return i}getAnnotation(){const t=new Map;let i=0;for(let s=0;s<this.config.height;s++)for(let e=0;e<this.config.width;e++){const n=!this.isEmpty(e,s),r=this.isEmpty(e,s-1),o=this.isEmpty(e-1,s);if(n&&(r||o)){const l=p.apply(e,s),h=r&&this.getWord(l,!0).length>1?this.getWord(l,!0):"",c=o&&this.getWord(l,!1).length>1?this.getWord(l,!1):"",a=[];h.length>1&&(i+=1,a.push(new C(i,!0,h))),c.length>1&&(i+=1,a.push(new C(i,!1,c))),t.set(l,a)}}return t}getWord(t,i){let s="";for(let e=0;e<Math.max(this.config.width,this.config.height);e++){const n=i?this.getChar(t.x,t.y+e):this.getChar(t.x+e,t.y);if(n===" "||n===void 0)break;s+=n}return s}getCharsShownInPartialSolution(t=new y,i=.3){let s=new Set;for(let e=0;e<this.config.height;e++)for(let n=0;n<this.config.width;n++)if(this.hasChar(n,e)){const r=p.apply(n,e),o=this.hasChar(n,e-1)||this.hasChar(n,e+1),l=this.hasChar(n-1,e)||this.hasChar(n+1,e);!(o&&l)&&t.nextDouble()<i&&!s.has(p.apply(n-1,e))&&!s.has(p.apply(n,e-1))&&s.add(r)}return s}static generate(t,i,s){const e=u.empty(s),n=u.initial(e,t,!1,!1),r=u.initial(e,t,!0,!1);return[u.generateAndFinalize(n,i),u.generateAndFinalize(r,i)]}static generateAndFinalize(t,i){let s=t,e=u.generateLoop(s,i,[]);for(;e.words.size>s.words.size;)s=e,e=u.generateLoop(s,i,[]);return e}static initial(t,i,s,e){const n=new y;if(e)return s?t.copyWithWord(t.config.width/2,(t.config.height-i.length)/2,s,i):t.copyWithWord((t.config.width-i.length)/2,t.config.height/2,s,i);if(s){const r=n.nextInt(t.config.width),o=n.nextInt(t.config.height-i.length+1);return t.copyWithWord(r,o,s,i)}else{const r=n.nextInt(t.config.width-i.length+1),o=n.nextInt(t.config.height);return t.copyWithWord(r,o,s,i)}}static finalize(t,i){const s=u.shuffleArray(i).slice(0,1e4).sort((e,n)=>n.length-e.length);return u.generateLoop(t,s,[])}static generateLoop(t,i,s){let e=t,n=i,r=s;for(;n.length>0;){const o=n[0];if(n=n.slice(1),e.words.has(o))continue;const l=e.addWord(o);if(l.length===0)r.unshift(o);else{const h=new y,c=l[h.nextInt(l.length)];return e=u.generateLoop(c,r.concat(n),[]),e}}return e}static shuffleArray(t){const i=t.slice();for(let s=i.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[i[s],i[e]]=[i[e],i[s]]}return i}toString(){[...Array(this.config.width).keys()];const t=[];for(let i=0;i<this.config.height;i++){let s="";for(let e=0;e<this.config.width;e++)s+=this.getChar(e,i);t.push(s)}return`Density: ${(this.density*100).toFixed(0)}%, Words: ${this.words.size}, ${this.config.width}x${this.config.height}
`+t.join(`
`)}}class I{static sortByBest(t){const i=t.join("").split(""),s=i.length,e=new Map;for(const r of i)e.set(r,(e.get(r)??0)+1);for(const[r,o]of e)e.set(r,o/s);function n(r){return r.split("").reduce((o,l)=>o+(e.get(l)??0),0)}return[...t].sort((r,o)=>n(o)-n(r))}}class L{constructor(t,i,s=10,e=500){this.width=t,this.height=i,this.attempts=s,this.dictionarySampleSize=e}generate(t){const i=t.map(a=>a.toUpperCase()),s=I.sortByBest(i);if(s.length===0)return{grid:this.emptyGrid(),words:[]};const e=s[0],n=s.slice(1),r=new E(this.width,this.height,!1),l=u.generate(e,n,r).sort((a,f)=>f.density-a.density)[0],h=this.convertGrid(l,r);console.log("Crossword before filling empty spaces:");for(const a of h)console.log(a.map(f=>f===" "?".":f).join(""));this.fillEmptySpaces(h);const c=this.extractWordInfo(l);return{grid:h,words:c}}emptyGrid(){return Array.from({length:this.height},()=>Array(this.width).fill(""))}convertGrid(t,i){const s=[];for(let e=0;e<i.height;e++){const n=[];for(let r=0;r<i.width;r++){let o=t.getChar(r,e);n.push(o)}s.push(n)}return s}extractWordInfo(t){const i=t.getAnnotation(),s=[];for(const[e,n]of i.entries())for(const r of n)s.push({word:r.word,startX:e.x,startY:e.y,isVertical:r.vertical,length:r.word.length});return s}fillEmptySpaces(t){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let s=0;s<this.height;s++)for(let e=0;e<this.width;e++)t[s][e]===" "&&(t[s][e]=i[Math.floor(Math.random()*i.length)])}}async function v(){try{const d=await fetch("https://vercel-darkword-backend.vercel.app/api/handler");if(!d.ok)throw new Error(`Failed to fetch: ${d.statusText}`);const t=await d.json();return{theme:t.theme,words:t.words,clues:Object.keys(t.clues).reduce((i,s)=>(i[s.toUpperCase()]=t.clues[s],i),{})}}catch(d){throw console.error("Error fetching words and clues:",d),d}}const g=7,m=7;class x{constructor(){this.puzzleGrid=[],this.words=[],this.validCells=new Set,this.peeksLeft=3,this.isPeeking=!1,this.peekTimeout=null,this.theme=null,this.initialPuzzle=null,this.startTime=null,this.timerInterval=null,this.peekCooldown=!1,this.blackedOutCells=Array(m).fill(null).map(()=>Array(g).fill(!1)),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}async init(){try{await this.setupTheme(),this.setupUIElements(),this.generatePuzzle(),this.renderGame(),this.updatePeekButton(),this.startTimer()}catch(t){console.error("Error initializing game:",t),this.showError("Failed to load the game. Please try refreshing the page.")}}async setupTheme(){try{const t=await v();this.theme={name:t.theme,words:t.words,clues:t.clues}}catch(t){throw console.error("Error fetching theme:",t),t}}startTimer(){this.startTime=Date.now(),this.timerInterval!==null&&window.clearInterval(this.timerInterval),this.timerInterval=window.setInterval(()=>{this.updateTimerDisplay()},1e3),this.updateTimerDisplay()}updateTimerDisplay(){const t=document.getElementById("timer");if(!t||this.startTime===null)return;const i=Math.floor((Date.now()-this.startTime)/1e3),s=Math.floor(i/60),e=i%60;t.textContent=`${s.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}stopTimer(){this.timerInterval!==null&&(window.clearInterval(this.timerInterval),this.timerInterval=null)}resetTimer(){this.stopTimer(),this.startTimer()}setupUIElements(){const t=document.getElementById("grid"),i=document.getElementById("submit-btn"),s=document.getElementById("reset-btn"),e=document.getElementById("peek-btn"),n=document.getElementById("peeks-left"),r=document.getElementById("message"),o=document.getElementById("theme-display"),l=document.getElementById("clues-section");if(!t||!i||!s||!e||!n||!r||!o||!l){console.error("Required DOM elements not found");return}i.addEventListener("click",()=>this.checkSolution()),s.addEventListener("click",()=>this.resetGrid()),e.addEventListener("click",()=>this.handlePeek()),t.addEventListener("click",h=>this.handleCellClick(h))}generatePuzzle(){if(this.theme){if(!this.initialPuzzle){const t=new L(g,m);this.initialPuzzle=t.generate(this.theme.words)}this.puzzleGrid=this.initialPuzzle.grid.map(t=>[...t]),this.words=[...this.initialPuzzle.words],this.validCells=this.getValidCells(),this.blackedOutCells=Array(m).fill(null).map(()=>Array(g).fill(!1))}}getValidCells(){const t=new Set;return this.words.forEach(i=>{const{word:s,startX:e,startY:n,isVertical:r}=i;for(let o=0;o<s.length;o++){const l=r?e:e+o,h=r?n+o:n;t.add(`${l},${h}`)}}),t}renderGame(){this.renderGrid(),this.renderClues(),this.renderTheme()}renderGrid(){const t=document.getElementById("grid");t&&(t.innerHTML="",this.puzzleGrid.forEach((i,s)=>{i.forEach((e,n)=>{const r=document.createElement("div");r.className="cell",r.textContent=e,r.dataset.row=s.toString(),r.dataset.col=n.toString(),this.blackedOutCells[s][n]&&r.classList.add("blackout"),t.appendChild(r)})}))}renderClues(){const t=document.getElementById("clues-list");!t||!this.theme||(t.innerHTML="",this.words.forEach(i=>{var n;const s=(n=this.theme)==null?void 0:n.clues[i.word];if(!s)return;const e=document.createElement("div");e.className="clue-item",e.textContent=`• ${s}`,e.dataset.word=i.word,e.addEventListener("mouseenter",()=>this.highlightWord(i)),e.addEventListener("mouseleave",()=>this.unhighlightWord(i)),t.appendChild(e)}))}renderTheme(){const t=document.getElementById("theme-display");!t||!this.theme||(t.textContent=`Today's theme: ${this.theme.name}`)}handleCellClick(t){const i=t.target;if(!i.classList.contains("cell"))return;const s=parseInt(i.dataset.row||"0",10),e=parseInt(i.dataset.col||"0",10);this.toggleCell(i,s,e),this.clearMessage()}toggleCell(t,i,s){t.classList.toggle("blackout"),this.blackedOutCells[i][s]=!this.blackedOutCells[i][s]}handlePeek(){if(this.peeksLeft<=0||this.isPeeking||this.peekCooldown)return;this.isPeeking=!0,this.peeksLeft--,this.peekCooldown=!0,this.updatePeekButton();const t=[];for(let s=0;s<m;s++)for(let e=0;e<g;e++)!this.validCells.has(`${e},${s}`)&&!this.blackedOutCells[s][e]&&t.push({row:s,col:e});for(let s=t.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[t[s],t[e]]=[t[e],t[s]]}t.slice(0,3).forEach(({row:s,col:e})=>{const n=document.querySelector(`[data-row="${s}"][data-col="${e}"]`);n&&n.classList.add("peek","hint-blackout")}),this.peekTimeout&&clearTimeout(this.peekTimeout),this.peekTimeout=window.setTimeout(()=>{document.querySelectorAll(".cell.peek").forEach(s=>{s.classList.remove("peek","hint-blackout")}),this.isPeeking=!1,setTimeout(()=>{this.peekCooldown=!1,this.updatePeekButton()},2e3)},2e3)}updatePeekButton(){const t=document.getElementById("peeks-left"),i=document.getElementById("peek-btn");t&&(t.textContent=this.peeksLeft.toString()),i&&(this.peeksLeft<=0?(i.disabled=!0,i.textContent="No Peeks Left"):this.isPeeking||this.peekCooldown?(i.disabled=!0,i.innerHTML=`Peek (${this.peeksLeft}) <span class="cooldown"></span>`):(i.disabled=!1,i.textContent=`Peek (${this.peeksLeft})`))}checkSolution(){let t=!0;for(let i=0;i<m;i++)for(let s=0;s<g;s++){const e=!this.validCells.has(`${s},${i}`),n=this.blackedOutCells[i][s];e!==n&&(t=!1)}this.showSolutionFeedback(t)}showSolutionFeedback(t){const i=document.getElementById("message");i&&(i.className=`message ${t?"success":"error"}`,i.textContent=t?"Congratulations! You've revealed the hidden crossword!":"Not quite right. Keep trying!");const s=document.getElementById("grid");s&&(s.querySelectorAll(".cell").forEach(e=>{const n=e,r=parseInt(n.dataset.row||"0",10),o=parseInt(n.dataset.col||"0",10),l=!this.validCells.has(`${o},${r}`),h=n.classList.contains("blackout");n.classList.remove("correct-cell","incorrect-cell"),t?l?n.classList.add("solution-blackout"):n.classList.add("solution-word"):l===h?n.classList.add("correct-cell"):n.classList.add("incorrect-cell")}),t&&(document.querySelectorAll(".clue-item").forEach(e=>{e.classList.add("solved")}),this.stopTimer()))}resetGrid(){this.blackedOutCells=Array(m).fill(null).map(()=>Array(g).fill(!1)),document.querySelectorAll(".cell").forEach(t=>{t.classList.remove("blackout","peek")}),document.querySelectorAll(".clue-item").forEach(t=>{t.classList.remove("solved")}),this.clearMessage()}clearMessage(){const t=document.getElementById("message");t&&(t.className="message",t.textContent="")}showError(t){const i=document.getElementById("message");i&&(i.className="message error",i.textContent=t)}highlightWord(t){const{word:i,startX:s,startY:e,isVertical:n}=t;for(let r=0;r<i.length;r++){const o=n?s:s+r,l=n?e+r:e,h=document.querySelector(`[data-row="${l}"][data-col="${o}"]`);h&&!h.classList.contains("blackout")&&h.classList.add("highlight")}}unhighlightWord(t){const{word:i,startX:s,startY:e,isVertical:n}=t;for(let r=0;r<i.length;r++){const o=n?s:s+r,l=n?e+r:e,h=document.querySelector(`[data-row="${l}"][data-col="${o}"]`);h&&h.classList.remove("highlight")}}}console.log("Initializing Game...");document.addEventListener("DOMContentLoaded",()=>{new x});
